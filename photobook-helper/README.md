# Photo Book Creation Instructions

This page details instructions about how to run the
[photobook_helper.py script](photobook_helper.py) that reads a large list of images from a file,
and sends them in batches to the
[PhotoCollage](https://github.com/adrienverge/PhotoCollage.git) project to make pages for photo
books one page at a time. The user can easily control how many images are shown on each page and
go back to update previous batches / pages if desired.

- Open the HTML site that was generated by
  [shotwell-site-generator](https://github.com/masneyb/shotwell-site-generator) in your browser.
  From one of the event or tag pages, click on the Search link, and limit the results further
  if desired. Click the `CSV Download` link at the top of the search page and save the generated
  `media.csv` file.

- For my photo books, I export a series of CSV files for events that occurred throughout the
  year, and chain together all of the images into a PDF that can be sent off to the book
  printer. I store the media.csv files in nested directories like so to make it easy to control
  how the pages will be ordered in the generated PDF:

      01-Family/05-Event1
      01-Family/10-Event2
      ...
      02-Schools/05-School1
      02-Schools/10-School2
      ...
      03/Outdoors/05-Event1
      ...

- Clone the PhotoCollage project from <https://github.com/adrienverge/PhotoCollage.git>. Merge
  a separate branch that adds support for choosing the image export quality.

      git remote add ojob https://github.com/ojob/PhotoCollage.git
      git fetch ojob
      git merge ojob/choose-export-quality

  I ordered a 13"x11" landscape book from <https://www.blurb.com> so add a preset around line 669
  in `photocollage/gtkgui.py`:

      ("12.625in x 10.875in  landscape (300ppi)", (3756, 3262)),

  Note that this gives room for an extra 16px border on the left and right that's added below when
  the PDF is created. Create a run.sh script in the PhotoCollage directory:

      #!/usr/bin/env bash
      export PYTHONPATH=$(dirname $0)
      "${PYTHONPATH}/bin/photocollage" $@

  I have a branch at <https://github.com/masneyb/PhotoCollage> with all of these changes.

- Process the downloaded `media.csv` files with the [csv-to-filelist.sh](csv-to-filelist.sh) script
  to extract out the filenames:

      csv-to-filelist.sh < media.csv > files.txt

  `files.txt` will only contain the input images to use for the collage.

- Paste the contents of the generated `files.txt` file into the
  [photo-sorter.html](photo-sorter.html) page via a web browser to help filter the list of photos
  even further.

- If you want to add text to a page, then use ImageMagick to create that text on a separate image
  and add it to the top of `files.txt`:

      convert -background black -gravity center -fill white -font FreeSans-Bold -size 1000x1000 \
          -pointsize 96 caption:'This is the title' caption.jpg

  The caption image can be moved around in PhotoCollage like any other image.

- Call the photobook helper script with the command:

      photobook_helper.py --infile files.txt --photocollage-bin ~/src/PhotoCollage/run.sh

  By default only 10 images are passed to PhotoCollage. If you want more or less photos, then
  simply close the PhotoCollage program and [photobook_helper.py](photobook_helper.py) will
  prompt you for the next action:

      Enter new number of photos for batch (10 / 86);
          (c)ontinue to next batch, (l)ast batch, or (q)uit: 

  There's 10 photos in the current page, and 86 additional photos in this example. Enter a new
  number of photos to pass to PhotoCollage, `c` to finish the current batch of photos and move
  onto the next, `l` to go back to the previous batch, or `q` to quit.

- Once all of the individual pages are created, a single PDF can be generated with the command:

      convert page* -gravity center -background black -extent 3788x3262 -units PixelsPerInch -density 300x300 book.pdf

- If the convert command fails, check to ensure that your /tmp directory has enough space. The
  command will also fail if the system runs out of memory. Additional swap space can be temporarily
  added by running:

      sudo dd if=/dev/zero of=~/swapfile bs=1M count=10240
      sudo mkswap ~/swapfile
      sudo chmod 0600 ~/swapfile
      sudo swapon ~/swapfile

- I have a [series of scripts](pdf-scripts/) that I put in the toplevel directory for my project
  that implement what's described above.

- To add your PDFs and zipped up source material to your photo library, create a static HTML page
  `photobooks/index.html` under your photos HTML directory that links to all of your material.
  You can have `shotwell_site_generator.py` link to that page in your photo library by adding the
  following command line arguments:

      --extra-header-link "photobooks/index.html"
      --extra-header-link-descr "Book"
