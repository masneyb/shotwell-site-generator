<html>
  <body style="text-align:center; background:black;">
    <img id="image" style="width:100%; height:100%; object-fit:contain;"/>
    <script>
      function getIntQueryParameter(name, default_value) {
        var urlParams = new URLSearchParams(window.location.search);
        return urlParams.has(name) ? parseInt(urlParams.get(name), 10) : default_value;
      }

      function isValidMedia(media) {
        if (media["media_id"].startsWith("video"))
          return false;

        var minTime = getIntQueryParameter("min_time", null);
        if (minTime != null && media["exposure_time"] < minTime)
          return false;

        var maxTime = getIntQueryParameter("max_time", null);
        if (maxTime != null && media["exposure_time"] > maxTime)
          return false;

	return true;
      }

      function updateImage() {
        var num = null;
        do {
           num = Math.round(Math.random() * all_media["media"].length);
        } while (!isValidMedia(all_media["media"][num]));

        document.getElementById("image").src = all_media["media"][num].link;
      }

      var all_media = null;
      var xmlhttp = new XMLHttpRequest();
      xmlhttp.onreadystatechange = function() {
        if (this.readyState == 4 && this.status == 200) {
          all_media = JSON.parse(this.responseText);
          updateImage();
        }
      };
      xmlhttp.open("GET", "media.json", true);
      xmlhttp.send(); 

      var updateTime = getIntQueryParameter("update_time", 10000);
      setInterval(updateImage, updateTime);
    </script>
  </body>
</html>
